<app-combat-test *ngIf="combatService.combatActive"></app-combat-test>

<main *ngIf="!combatService.combatActive">
    <div class="storyText" #gameBox #story *ngIf="viewingMain.isActive">
    </div>

    <div class="playerOptions" #gameBox *ngIf="viewingMain.isActive">
        <div id="playerMainOptions">
            <!-- <p *ngFor="let option of mainMenuOptions; let i = index" (click)="optionSelected(i+1)" [ngClass]="{'actionDisabled': combatService.party.members[memberIndex]?.ATB < 100 || intervalID === null}" >{{(i+1) + '. ' + option}}</p>
            <p *ngIf="intervalID !== null" (click)="stopATB()" [ngClass]="{'actionDisabled': intervalID === null}">{{mainMenuOptions.length + 1 + '. Pause'}}</p>
            <p *ngIf="intervalID === null" (click)="startCombat()" [ngClass]="{'actionDisabled': intervalID !== null || enemyForm.controls.enemySelected.value === null}">{{mainMenuOptions.length + 1 + '. Resume'}}</p> -->
        </div>
    </div>
    
<!--Inventory Menu----------------------------------------------------------------------------------------------------------------------------------->
    <div class="inventoryDiv inventoryDivTop" *ngIf="viewingInventory.isActive">
        <div>
            <p *ngIf="viewingConsumables">Inventory - Consumables</p>
            <p *ngIf="!viewingConsumables">Inventory - Equipment</p>
            <p *ngIf="!viewingConsumables" class="displaySwap" (click)="inventoryDisplaySwap()">View Consumables</p>
            <p *ngIf="viewingConsumables" class="displaySwap" (click)="inventoryDisplaySwap()">View Equipment</p>
        </div>

        <p class="indent detailsPlaceholder" *ngIf="!selectedItem">Select an item to view it's details</p>
        
        <div class="overflowAuto infoDiv">
            <p class="header">{{selectedItem?.name}}</p>
            <section *ngIf="selectedItem && !viewingConsumables" class="overflowAuto display">
                <p class="indent" *ngIf="selectedItem?.description">Description: &nbsp;{{selectedItem?.description}}</p>
                <p class="indent" *ngIf="selectedItem?.accuracy">Accuracy: &nbsp;{{selectedItem?.accuracy}}</p>
                <p class="indent" *ngIf="selectedItem?.crit">Crit: &nbsp;{{selectedItem?.crit}}</p>
                <div *ngIf="selectedItem?.damageResistances.length > 0">
                    <p class="indent">Damage Resistances:</p>
                    <p class="indent2x" *ngFor="let DR of selectedItem?.damageResistances | capitalSplit: 'resistance'">{{'- ' + DR.name + DR.value}}</p> 
                </div>
                <div *ngIf="selectedItem?.damageTypes.length > 0">
                    <p class="indent">Damage Types:</p>
                    <p class="indent2x" *ngFor="let DT of selectedItem?.damageTypes | capitalSplit: 'percent'">{{'- ' + DT.name + DT.value}}</p>
                </div>
                <p class="indent" *ngIf="selectedItem?.defense">Defense: &nbsp;{{selectedItem?.defense}}</p>
                <p class="indent" *ngIf="selectedItem?.evasion">Evasion: &nbsp;{{selectedItem?.evasion}}</p>
                <p class="indent" *ngIf="selectedItem?.luck">Luck: &nbsp;{{selectedItem?.luck}}</p>
                <p class="indent" *ngIf="selectedItem?.speed">Speed: &nbsp;{{selectedItem?.speed}}</p>
                <div *ngIf="selectedItem?.statusEffectResistances.length > 0">
                    <p class="indent">Status Resistances: </p>
                    <p class="indent2x" *ngFor="let SR of selectedItem?.statusEffectResistances | capitalSplit: 'resistance'">{{'- ' + SR.name + SR.value}}</p>
                </div>
                <p class="indent" *ngIf="selectedItem?.strength">Strength: &nbsp;{{selectedItem?.strength}}</p>
                <p class="indent" *ngIf="selectedItem?.invelligence">Intelligence: &nbsp;{{selectedItem?.invelligence}}</p>
            </section>
            <section *ngIf="selectedItem && viewingConsumables" class="overflowAuto display">
                <p class="indent">Number held: &nbsp;{{selectedItem?.amount}}</p>
                <p class="indent">Can Target Enemies: &nbsp;{{selectedItem?.canTargetEnemies}}</p>
                <div *ngIf="selectedItem?.effects.length > 0">
                    <p class="indent">Effects: </p>
                    <p class="indent2x" *ngFor="let effect of selectedItem?.effects">{{'- ' + effect.helpDescription}}</p>
                </div>
                <div *ngIf="selectedItem?.spell">
                    <p class="indent">Casts <span [class]="selectedItem.spell.textColor">{{selectedItem.spell.name}}</span> on selected target</p>
                </div>
            </section>
        </div>
    </div>

    <div class="inventoryDiv overflowAuto" *ngIf="viewingInventory.isActive && !viewingConsumables">
        <p class="header">Bracers:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Bracer'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Helms:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Helm'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Chestplates:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Chestplate'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Pants:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Pants'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Greaves:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Greaves'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Weapons:</p>
        <section class="item"> <div (click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Weapon'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
        
        <p class="header">Trinkets:</p>
        <section class="item"> <div class="indent"(click)="viewItemDetails(item)" *ngFor="let item of combatService.party.inventory | equipmentFilter: 'Trinket'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
    </div>
    
    <div class="inventoryDiv overflowAuto" *ngIf="viewingInventory.isActive && viewingConsumables">
        <p class="header">Potions:</p>
        <section class="item"> <div (click)="viewItemDetails(item)" *ngFor="let item of combatService.party.consumables | consumableFilter: 'Potion'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>

        <p class="header">Scrolls:</p>
        <section class="item"> <div (click)="viewItemDetails(item)" *ngFor="let item of combatService.party.consumables | consumableFilter: 'Scroll'; let i = index">{{i+1 + '. ' + item.name}}</div> </section>
    </div>
    
<!--Equipment Menu----------------------------------------------------------------------------------------------------------------------------------->
    <div class="equipmentDiv" *ngIf="viewingEquipment.isActive">
        Equipment
    </div>

    <div class="equipmentDiv" *ngIf="viewingEquipment.isActive">
        Equipment
    </div>

<!--Stats Menu----------------------------------------------------------------------------------------------------------------------------------------->
    <div class="statsDiv" *ngIf="viewingStats.isActive">
        Stats
    </div>

    <div class="statsDiv" *ngIf="viewingStats.isActive">
        Stats
    </div>

<!--Settings menu--------------------------------------------------------------------------------------------------------------------------------------->
    <div class="settingsDiv" *ngIf="viewingSettings.isActive">
        Settings
    </div>

    <div class="settingsDiv" *ngIf="viewingSettings.isActive">
        Settings
    </div>
<!-------------------------------------------------------------------------------------------------------------------------------------------------------->


    <div class="gameOptions">
        <div #inventory (click)="switchView('inventory')">
            <p *ngIf="!viewingInventory.isActive">Inventory</p>
            <p *ngIf="viewingInventory.isActive">Back</p>
        </div>
        <div #equipment (click)="switchView('equipment')">
            <p *ngIf="!viewingEquipment.isActive">Equipment</p>
            <p *ngIf="viewingEquipment.isActive">Back</p>
        </div>
        <div #stats (click)="switchView('stats')">
            <p *ngIf="!viewingStats.isActive">Stats</p>
            <p *ngIf="viewingStats.isActive">Back</p>
        </div>
        <div #settings (click)="switchView('settings')">
            <p *ngIf="!viewingSettings.isActive">Settings</p>
            <p *ngIf="viewingSettings.isActive">Back</p>
        </div>
    </div>
    
    <div class="playerBars">
        <form [formGroup]="partyForm" class="partyForm">
            <div class="memberBox" #memberBoxes *ngFor="let member of combatService.party.members; let i = index" (click)="selectPartyMember(i, $event.target)">
                <div class="innerBoxWrapper">
                    <div>
                        <label>{{member.name}}</label>
                        <p style="margin-top: 5px; color: crimson;">{{member.health}} / {{member.maxHealth}}</p>
                        <p style="color: orchid;">{{member.mana}} / {{member.maxMana}}</p>
                    </div>

                    <div class="statusEffects">
                    </div>
                    
                    <div style="width: 100%;">
                        <input type="radio" [formControlName]="'memberSelected'" [value]="i" class="hidden">
                    </div>
                </div>
            </div>
        </form>
    </div>
</main>